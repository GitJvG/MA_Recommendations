<div class="container" data-band-id="{{ band.band_id }}">
    <h1 class="title">{{ name }}</h1>
    <div class="card">
        <div class="card-body">
            <!-- Left Content -->
            <div class="card-body-left">
                <p class="card-text"><strong>Country:</strong> {{ band.country }}</p>
                <p class="card-text"><strong>Location:</strong> {{ band.location }}</p>
                <p class="card-text"><strong>Status:</strong> {{ band.status }}</p>
                <p class="card-text"><strong>Formed in:</strong> {{ band.year_formed }}</p>
            </div>
            
            <!-- Right Content -->
            <div class="card-body-right">
                <p class="card-text"><strong>Genres:</strong> {{ band.genre }}</p>
                <p class="card-text"><strong>Themes:</strong> {{ band.themes }}</p>
                <p class="card-text"><strong>Label:</strong> {{ band.label }}</p>
            </div>
        </div>
    </div>
</div>
<div class="custom-dropdown">
    <button id="discographyFilterBtn" class="filter-btn"><div id="filterTitle">Filtered: None</div></button>
    <div id="dropdownMenu" class="dropdown-menu">
        <div>
            <label><input type="checkbox" value="all"> All</label>
        </div>
        {% for type in types %}
            <div>
                <label><input type="checkbox" value="{{ type }}" {% if type == 'EP' or type == 'Full-length' %}checked{% endif %}> {{ type }}</label>
            </div>
        {% endfor %}
    </div>
</div>

    {% if albums %}
    <table class="table" id="discographyTable">
        <thead>
            <tr>
                <th>Album Name</th>
                <th>Type</th>
                <th>Year</th>
                <th>Reviews</th>
                <th>Video</th>
            </tr>
        </thead>
        <tbody>
            {% for album in albums %}
            <tr data-type="{{ album.type }}">
                <td>{{ album.album_name }}</td>
                <td>{{ album.type }}</td> 
                <td>{{ album.year }}</td>  
                <td>{{ album.reviews }}</td>  
                <td>
                    <button class="btn btn-primary btn-sm" onclick="fetchVideo('{{ album.album_name }}', '{{ band.Band_Name }}')">Watch</button>
                    <div id="video-placeholder-{{ album.album_name|replace(' ', '_') }}"></div> <!-- Placeholder for the video -->
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No discography available for this band.</p>
    {% endif %}
</div>

<script>
    function fetchVideo(albumName, bandName) {
        const videoPlaceholder = document.getElementById(`video-placeholder-${albumName.replace(/\s/g, '_')}`);

        // If the video is already loaded, skip the fetch
        if (videoPlaceholder.innerHTML.trim()) {
            return;
        }

        // Fetch the video data via AJAX
        fetch(`/fetch_video?album_name=${encodeURIComponent(albumName)}&band_name=${encodeURIComponent(bandName)}`)
            .then(response => response.json())
            .then(data => {
                if (data.video_url) {
                    videoPlaceholder.innerHTML = `
                        <iframe width="200" height="113" src="${data.video_url}" frameborder="0" allowfullscreen></iframe>
                    `;
                } else {
                    videoPlaceholder.innerHTML = '<p>No video found for this album.</p>';
                }
            })
            .catch(error => {
                videoPlaceholder.innerHTML = `<p>Error loading video: ${error}</p>`;
            });
    }
</script>